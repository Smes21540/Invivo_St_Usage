canvas.addEventListener("mouseup", async () => {
  if (chart.$draggingNote) {
    const n = chart.$draggingNote;
    chart.$draggingNote = null;
    setZoomSuspended(false); // üß© r√©active le zoom/pan une fois l√¢ch√©

    try {
      // üîπ envoi des nouvelles coordonn√©es au script Google
      const resp = await fetch(
        "https://script.google.com/macros/s/AKfycbz9zcweeyv7GpC4ZCLnw57uVvuHEOWEmfbvnLHVaqZ8Php179viedbf7PX8Vmi8HhTX7Q/exec",
        {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            status: "update",
            folderId: localStorage.getItem("lastFolderId"),
            csvName: baseFileName,
            createdAt: n.createdAt,
            x: n.x,
            y: n.y,
            color: n.color || colorFromAuthor(n.author || "Anonyme")
          })
        }
      );

      console.log("üì§ Position mise √† jour :", await resp.text());
      showToast("üìç Position mise √† jour !");
    } catch (err) {
      console.error("‚ö†Ô∏è Erreur MAJ position :", err);
      showToast("‚ùå Erreur mise √† jour");
    }
  }
});
